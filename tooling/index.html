<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Unified Repo Tool — Cleaner • Bundle • Deploy</title>
  <link rel="stylesheet" href="./styles.css">
  <style>/* fallback minimal if stylesheet fails */</style>
</head>
<body>
  <div class="wrap">
    <header class="banner">
      <div class="title">
        <h1>Unified Repo Tool</h1>
        <div class="subtitle">Cleaner • Bundle • Deploy — client‑side only</div>
      </div>
      <div class="grid grid-4">
        <label>Owner<input id="owner" type="text" placeholder="MarcLeGuyader"></label>
        <label>Repository<input id="repo" type="text" placeholder="CRM"></label>
        <label>Branch<input id="branch" type="text" placeholder="main" value="main"></label>
        <label>Deploy root dir<input id="target-root" type="text" placeholder="/" value="/"></label>
      </div>
      <div class="grid grid-3">
        <label>GitHub Token (fine‑grained, contents:read/write)
          <input id="token" type="password" placeholder="github_pat_...">
        </label>
        <label>Mode
          <select id="mode">
            <option value="patch">Patch (add/update only)</option>
            <option value="replace">Replace in target (delete missing)</option>
          </select>
        </label>
        <label>Dry‑run (simulate only)
          <select id="dryrun">
            <option value="on" selected>ON (recommended)</option>
            <option value="off">OFF</option>
          </select>
        </label>
      </div>
      <div class="row">
        <button id="btn-connect" class="primary">Connect</button>
        <button id="btn-refresh">Refresh tree</button>
        <button id="btn-select-all">Select all</button>
        <button id="btn-select-none">Select none</button>
        <div class="status" id="status">Ready.</div>
      </div>
      <div class="progress">
        <progress id="prog" max="100" value="0"></progress>
        <span id="prog-text">0%</span>
      </div>
    </header>

    <main class="main">
      <section class="tree-panel">
        <div class="tree-header">
          <h2>Project tree</h2>
          <input id="filter" type="text" placeholder="Filter paths (press Enter)"/>
        </div>
        <div id="tree" class="tree"></div>
      </section>

      <section class="actions">
        <h2>Actions</h2>
        <div class="cards">
          <div class="card">
            <h3>A) Export JSON of selection</h3>
            <p>Get a JSON describing selected files (paths, types).</p>
            <div class="row">
              <button id="btn-export-json">Export JSON</button>
              <button id="btn-export-json-dl">Download JSON</button>
            </div>
            <textarea id="out-json" placeholder='JSON will appear here…' readonly></textarea>
          </div>

          <div class="card">
            <h3>B) Export listing of tree</h3>
            <p>Export a textual or JSON listing of the project tree (selection or full tree).</p>
            <div class="row">
              <select id="list-scope">
                <option value="selection">Selection only</option>
                <option value="all">Full tree</option>
              </select>
              <select id="list-format">
                <option value="text">Text (.txt)</option>
                <option value="json">JSON (.json)</option>
              </select>
              <button id="btn-export-list">Export listing</button>
            </div>
            <textarea id="out-list" placeholder='Listing preview…' readonly></textarea>
          </div>

          <div class="card">
            <h3>C) Delete selected files</h3>
            <p>Dry‑run shows all DELETE operations. Apply requires confirmation; protected paths are skipped unless explicitly allowed.</p>
            <div class="row">
              <label class="inline"><input id="allow-protected" type="checkbox"> Allow protected paths (.github/workflows, LICENSE, README.md, CNAME)</label>
            </div>
            <div class="row">
              <button id="btn-delete-dry" class="ghost">Dry‑run delete</button>
              <button id="btn-delete-apply" class="danger">Apply delete</button>
            </div>
          </div>

          <div class="card">
            <h3>D) Deploy (ZIP or single file)</h3>
            <p>Deploy to the target root dir. Patch adds/updates only. Replace also deletes files missing from the archive within target.</p>
            <div class="row">
              <input id="deploy-file" type="file" accept=".zip,*/*"/>
              <button id="btn-deploy-dry" class="ghost">Dry‑run deploy</button>
              <button id="btn-deploy-apply" class="primary">Apply deploy</button>
            </div>
          </div>
        </div>
      </section>
    </main>

    <section class="console">
      <div class="console-header">
        <h2>Console</h2>
        <div class="row">
          <select id="log-filter">
            <option value="all">All</option>
            <option value="dryrun">DRYRUN</option>
            <option value="apply">APPLY</option>
            <option value="warn">WARN</option>
            <option value="error">ERROR</option>
            <option value="summary">SUMMARY</option>
          </select>
          <button id="btn-log-clear">Clear</button>
          <button id="btn-log-copy">Copy</button>
          <button id="btn-log-dl">Download log</button>
        </div>
      </div>
      <pre id="log"></pre>
    </section>

    <footer class="footer">
      Unified Repo Tool — V0.1 — Generated on 2025-10-07T19:42:19Z
    </footer>
  </div>

  <script defer src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
  <script type="module" src="./app.js"></script>
</body>
</html>
